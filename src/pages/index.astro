---
import Layout from "../layouts/Layout.astro";
import { getCollection } from "astro:content";

const posts = (await getCollection("blog")).sort(
  (a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf()
);

const jobs = await getCollection("jobs");

const formatter = new Intl.DateTimeFormat("en-ZA", {
  month: "short",
  year: "numeric",
});

import Experience from "@images/experience.svg";
---

<Layout>
  <h1
    class="font-source-serif font-weight-normal leading-[1.7] text-pretty text-4xl mt-4 mb-8"
  >
    <span>ðŸ‘‹</span> Hello, I'm <span
      id="underline"
      class="whitespace-nowrap cursor-pointer">Gareth</span
    > - A <span id="box" class="whitespace-nowrap relative"
      >senior <Experience class="absolute -top-10 left-8 w-24 h-12" /></span
    > frontend developer passionate about crafting
    <span id="highlight" class="whitespace-nowrap">user-centric</span> websites and
    applications.
  </h1>

  <p class="text-pretty text-neutral-800 mb-8">
    With <strong>over a decade of experience</strong>, I specialize in
    transforming complex ideas into sleek, high-performing websites and
    applications. Currently, I'm a
    <strong>senior frontend developer at Mercedes-Benz</strong>, where I develop
    innovative, user-friendly features and applications, working remotely from
    the beautiful <strong>Muizenberg, South Africa</strong>.
  </p>

  <div class="grid grid-cols-1 md:grid-cols-2 gap-4 relative">
    <section class="order-last">
      <div
        class="bg-neutral-100/50 border border-neutral-100 p-4 rounded-lg shadow-sm sticky top-4"
      >
        <h2 class="font-bold text-lg mb-2 flex items-center gap-2">
          <svg
            xmlns="http://www.w3.org/2000/svg"
            width="1em"
            height="1em"
            viewBox="0 0 16 16"
          >
            <path
              fill="currentColor"
              fill-rule="evenodd"
              d="M6 1a1.75 1.75 0 0 0-1.75 1.75V4H3a2 2 0 0 0-2 2v7a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V6a2 2 0 0 0-2-2h-1.25V2.75A1.75 1.75 0 0 0 10 1zm4.25 3V2.75A.25.25 0 0 0 10 2.5H6a.25.25 0 0 0-.25.25V4zM3 5.5h10a.5.5 0 0 1 .5.5v1h-11V6a.5.5 0 0 1 .5-.5m-.5 3V13a.5.5 0 0 0 .5.5h10a.5.5 0 0 0 .5-.5V8.5H9V10H7V8.5z"
              clip-rule="evenodd"></path>
          </svg>
          Work
        </h2>
        <ol class="flex flex-col space-y-2">
          {
            jobs.map((job: any) => (
              <li class="flex gap-4">
                <dl class="flex flex-auto flex-wrap gap-x-2">
                  <dt class="sr-only">Company</dt>
                  <dd class="w-full flex-none font-bold text-sm">
                    {job.data.companyName}
                  </dd>
                  <dt class="sr-only">Role</dt>
                  <dd class="text-xs">{job.data.title}</dd>
                  <dt class="sr-only">Date</dt>
                  <dd class="ml-auto text-xs" aria-label="2019 until Present">
                    <time>{formatter.format(job.data.start)}</time>
                    <span aria-hidden="true">&ndash;</span>
                    <time>
                      {!job.data.end
                        ? "Present"
                        : formatter.format(job.data.end)}
                    </time>
                  </dd>
                </dl>
              </li>
            ))
          }
        </ol>
      </div>
    </section>

    <section class="">
      <h3 class="font-bold text-lg mb-2">Latest posts</h3>
      <ul class="text-sm space-y-2">
        {
          posts.map((post: any) => (
            <li class="bg-neutral-100/50 p-3 rounded-lg">
              <header class="flex flex-col gap-1 justify-between mb-3">
                <a class="text-blue-700" href={`/blog/${post.id}`}>
                  <h6 class="font-bold">{post.data.title}</h6>
                </a>
                <time class="text-xs text-neutral-600">
                  Published:
                  {new Date(post.data.pubDate).toLocaleDateString("en-ZA", {
                    year: "numeric",
                    month: "short",
                    day: "numeric",
                  })}
                </time>
              </header>

              <p>{post.data.description}</p>

              <a
                class="flex items-center gap-2 text-sm mt-3 ml-auto text-blue-600"
                href={`/blog/${post.id}`}
              >
                Read more
              </a>
            </li>
          ))
        }
      </ul>
    </section>
  </div>
</Layout>